package br.senac.requestfood.service.consumable;

import java.util.Base64;
import java.util.List;

import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;

import br.senac.requestfood.dto.consumable.ConsumableImageDTO;
import br.senac.requestfood.dto.consumable.ConsumableRoleDTO;
import br.senac.requestfood.dto.establishment.EstablishmentWithConsumablesDTO;
import br.senac.requestfood.exception.consumable.ConsumableNotFoundException;
import br.senac.requestfood.exception.establishment.EstablishmentNotFoundException;
import br.senac.requestfood.model.consumable.Consumable;
import br.senac.requestfood.model.consumable.drink.Drink;
import br.senac.requestfood.projection.consumable.ConsumableProjection;
import br.senac.requestfood.projection.establishment.EstablishmentProjection;
import br.senac.requestfood.repository.consumable.ConsumableRepository;
import br.senac.requestfood.repository.drink.DrinkRepository;
import br.senac.requestfood.repository.establisment.EstablishmentRepository;
import br.senac.requestfood.util.ImageUtil;

@Service
public class ConsumableServiceImpl implements ConsumableService{

	private final ConsumableRepository repository;
	private final DrinkRepository drinkRepository;
	private final EstablishmentRepository establishmentRepository;
	
	public ConsumableServiceImpl(ConsumableRepository repository, EstablishmentRepository establishmentRepository,
			DrinkRepository drinkRepository) {
		this.repository = repository;
		this.establishmentRepository = establishmentRepository;
		this.drinkRepository = drinkRepository;
	}

	public void delete(Long id) {
		if(!repository.existsById(id))
			throw new ConsumableNotFoundException("Consumable "+ id +" was not found");
		
		repository.deleteById(id);
	}
	
	public ConsumableProjection findById(Long id) {
		
		ConsumableProjection consumable = repository.findConsumableById(id).orElseThrow(() -> new ConsumableNotFoundException("Consumable "+ id +" was not found."));
		
		return consumable;
	}
	
	public ConsumableRoleDTO findTypeById(Long id) {
	
		Drink consumable = drinkRepository.findById(id).orElse(null);
		
		if(consumable == null)
			return new ConsumableRoleDTO("dish");
		else
			return new ConsumableRoleDTO("drink");
	}
	
	public ConsumableImageDTO findByIdImage(Long id) {
		
		final Consumable dbImage = repository.findById(id).orElseThrow(() -> new ConsumableNotFoundException("Consumable "+ id +" was not found"));
		
		Drink drink = drinkRepository.findById(id).orElse(null);
		
		if (drink == null && dbImage.getImage() == null) 
			return new ConsumableImageDTO("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");
		if (dbImage.getImage() == null)
			return new ConsumableImageDTO("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");
		
		return new ConsumableImageDTO(Base64.getEncoder().encodeToString(ImageUtil.decompressBytes(dbImage.getImage())));
	}
	
	public EstablishmentWithConsumablesDTO findByName(Long id, String name, Integer page, Pageable pageable) {

		int size = 4;
		pageable = PageRequest.of(page,size, Sort.Direction.ASC, "name");
		
		EstablishmentProjection establishment = establishmentRepository.findEstablishmentById(id).orElseThrow(() -> new EstablishmentNotFoundException("Establishment " + id + " was not found"));
		return new EstablishmentWithConsumablesDTO(establishment.getId(), establishment.getName(), repository.findByNameContainingIgnoreCaseAndEstablishmentId(name, id, pageable));
	}

	public EstablishmentWithConsumablesDTO findByPriceByOrdemByAsc(Long id, Integer page, Pageable pageable) {

		int size = 4;
		pageable = PageRequest.of(page,size, Sort.Direction.ASC, "price");

		EstablishmentProjection establishment = establishmentRepository.findEstablishmentById(id).orElseThrow(() -> new EstablishmentNotFoundException("Establishment " + id + " was not found"));
		return new EstablishmentWithConsumablesDTO(establishment.getId(), establishment.getName(), repository.findAllByEstablishmentId(id, pageable));
	}
	
	public EstablishmentWithConsumablesDTO findByPriceByOrdemByDesc(Long id, Integer page, Pageable pageable) {
		
		int size = 4;
		pageable = PageRequest.of(page,size, Sort.Direction.DESC, "price");
		
		EstablishmentProjection establishment = establishmentRepository.findEstablishmentById(id).orElseThrow(() -> new EstablishmentNotFoundException("Establishment " + id + " was not found"));
		return new EstablishmentWithConsumablesDTO(establishment.getId(), establishment.getName(), repository.findAllByEstablishmentId(id, pageable));
	}
	
	public EstablishmentWithConsumablesDTO findAll(Long id, Integer page, Pageable pageable) {

		int size = 4;
		pageable = PageRequest.of(page,size, Sort.Direction.ASC, "name");
		
		EstablishmentProjection establishment = establishmentRepository.findEstablishmentById(id).orElseThrow(() -> new EstablishmentNotFoundException("Establishment " + id + " was not found"));
		return new EstablishmentWithConsumablesDTO(establishment.getId(), establishment.getName(), repository.findAllByEstablishmentId(id, pageable));
	}
	
	public List<ConsumableProjection> findAll() {
		return repository.findConsumables();
	}
}
